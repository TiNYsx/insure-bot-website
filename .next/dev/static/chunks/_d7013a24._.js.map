{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tinysx/Documents/GitHub/insure-bot-website/components/chat-interface.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useRef, useEffect } from 'react'\r\nimport { Send, Mic, Volume2, Menu } from 'lucide-react'\r\nimport { ChatMessage } from '@/types'\r\n\r\ninterface ChatInterfaceProps {\r\n  chatMessages: ChatMessage[]\r\n  onMessagesUpdate: (messages: ChatMessage[]) => void\r\n  volume: number\r\n  onToggleLeftPanel?: () => void\r\n}\r\n\r\nexport default function ChatInterface({\r\n  chatMessages,\r\n  onMessagesUpdate,\r\n  volume,\r\n  onToggleLeftPanel,\r\n}: ChatInterfaceProps) {\r\n  const [messages, setMessages] = useState<ChatMessage[]>(chatMessages)\r\n  const [input, setInput] = useState('')\r\n  const [isRecording, setIsRecording] = useState(false)\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [typingDots, setTypingDots] = useState('')\r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null)\r\n  const audioChunksRef = useRef<Blob[]>([])\r\n  const messagesEndRef = useRef<HTMLDivElement>(null)\r\n  const audioRef = useRef<HTMLAudioElement>(null)\r\n\r\n  // Safe logging utility\r\n  const safeLogError = (message: string, ...args: any[]) => {\r\n    if (typeof console !== 'undefined' && console.warn) {\r\n      (console as any).warn(message, ...args)\r\n    }\r\n  }\r\n\r\n  const safeLogWarn = (message: string, ...args: any[]) => {\r\n    if (typeof console !== 'undefined' && console.warn) {\r\n      (console as any).warn(message, ...args)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    setMessages(chatMessages)\r\n  }, [chatMessages])\r\n\r\n  // Typing animation\r\n  useEffect(() => {\r\n    if (isLoading) {\r\n      const interval = setInterval(() => {\r\n        setTypingDots(prev => prev === '...' ? '' : prev + '.')\r\n      }, 500)\r\n      return () => clearInterval(interval)\r\n    } else {\r\n      setTypingDots('')\r\n    }\r\n  }, [isLoading])\r\n\r\n  // Helper to update messages state and notify parent so chats are persisted\r\n  const updateMessages = (newMessages: ChatMessage[]) => {\r\n    setMessages(newMessages)\r\n    try {\r\n      onMessagesUpdate(newMessages)\r\n    } catch (err) {\r\n      safeLogError('onMessagesUpdate failed:', err)\r\n    }\r\n  }\r\n\r\n  // Auto scroll to bottom\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\r\n  }, [messages])\r\n\r\n  const getWebhookUrl = () => {\r\n    const config = localStorage.getItem('admin-config')\r\n    if (config) {\r\n      const parsed = JSON.parse(config)\r\n      try {\r\n        // Validate the URL string\r\n        if (!parsed.webhookUrl) return null\r\n        new URL(parsed.webhookUrl)\r\n        return parsed.webhookUrl\r\n      } catch (err) {\r\n        safeLogWarn('Invalid webhook URL in admin-config:', parsed.webhookUrl)\r\n        return null\r\n      }\r\n    }\r\n    return null\r\n  }\r\n\r\n  const startRecording = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true })\r\n      mediaRecorderRef.current = new MediaRecorder(stream)\r\n      audioChunksRef.current = []\r\n\r\n      mediaRecorderRef.current.ondataavailable = (event) => {\r\n        audioChunksRef.current.push(event.data)\r\n      }\r\n\r\n      mediaRecorderRef.current.onstop = async () => {\r\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' })\r\n        await sendAudio(audioBlob)\r\n        stream.getTracks().forEach(track => track.stop())\r\n      }\r\n\r\n      mediaRecorderRef.current.start()\r\n      setIsRecording(true)\r\n    } catch (err) {\r\n      safeLogError('Error accessing microphone:', err)\r\n      alert('ไม่สามารถเข้าถึงไมโครโฟนได้')\r\n    }\r\n  }\r\n\r\n  const stopRecording = () => {\r\n    if (mediaRecorderRef.current) {\r\n      mediaRecorderRef.current.stop()\r\n      setIsRecording(false)\r\n    }\r\n  }\r\n\r\n  const sendAudio = async (audioBlob: Blob) => {\r\n    setIsLoading(true)\r\n    \r\n    // Create user message with audio\r\n    const userMessage: ChatMessage = {\r\n      id: Date.now().toString(),\r\n      type: 'user',\r\n      text: 'ข้อความเสียง',\r\n      audio: URL.createObjectURL(audioBlob),\r\n      timestamp: new Date().toISOString(),\r\n    }\r\n\r\n    const updatedMessages = [...messages, userMessage]\r\n    updateMessages(updatedMessages)\r\n\r\n    // Send to webhook\r\n    const webhookUrl = getWebhookUrl()\r\n    if (!webhookUrl) {\r\n      const errorMessage: ChatMessage = {\r\n        id: (Date.now() + 1).toString(),\r\n        type: 'ai',\r\n        text: 'ไม่ได้กำหนดค่า Webhook หรือ URL ไม่ถูกต้อง กรุณาตั้งค่า URL Webhook ที่ถูกต้องในแผงควบคุมผู้ดูแล',\r\n        timestamp: new Date().toISOString(),\r\n      }\r\n      updateMessages([...updatedMessages, errorMessage])\r\n      setIsLoading(false)\r\n      return\r\n    }\r\n\r\n    try {\r\n      // Encode audio as base64 and send to our server proxy to avoid CORS / mixed-content issues\r\n      const toBase64 = (blob: Blob) => new Promise<string>((resolve, reject) => {\r\n        const reader = new FileReader()\r\n        reader.onload = () => {\r\n          const result = reader.result as string\r\n          const parts = result.split(',')\r\n          resolve(parts[1] || '')\r\n        }\r\n        reader.onerror = reject\r\n        reader.readAsDataURL(blob)\r\n      })\r\n\r\n      const audioBase64 = await toBase64(audioBlob)\r\n\r\n      const controller = new AbortController()\r\n      // Mirror the server timeout (5 minutes)\r\n      const timeout = setTimeout(() => controller.abort(), 300000)\r\n\r\n      const response = await fetch('/api/proxy', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          webhookUrl,\r\n          audioBase64,\r\n          audioFilename: 'audio.wav',\r\n          messages: updatedMessages.slice(-6),\r\n        }),\r\n        signal: controller.signal,\r\n      })\r\n      clearTimeout(timeout)\r\n\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        const aiMessage: ChatMessage = {\r\n          id: (Date.now() + 1).toString(),\r\n          type: 'ai',\r\n          text: data.output || 'ได้รับการตอบกลับแล้ว',\r\n          audio: data.audio ? `data:audio/mp3;base64,${data.audio}` : undefined,\r\n          timestamp: new Date().toISOString(),\r\n        }\r\n        const finalMessages = [...updatedMessages, aiMessage]\r\n        updateMessages(finalMessages)\r\n      } else {\r\n        safeLogError('Proxy returned non-OK status:', response.status)\r\n        const errorMessage: ChatMessage = {\r\n          id: (Date.now() + 1).toString(),\r\n          type: 'ai',\r\n          text: `ข้อผิดพลาดของพร็อกซี่: ${response.status} ${response.statusText}`,\r\n          timestamp: new Date().toISOString(),\r\n        }\r\n        updateMessages([...updatedMessages, errorMessage])\r\n      }\r\n    } catch (err) {\r\n      safeLogError('Error sending audio:', err)\r\n      const errorMessage: ChatMessage = {\r\n        id: (Date.now() + 1).toString(),\r\n        type: 'ai',\r\n        text: err && (err as any).name === 'AbortError' ? 'คำขอหมดเวลา กรุณาลองใหม่อีกครั้ง' : 'ไม่สามารถส่งข้อความของคุณได้ กรุณาตรวจสอบเครือข่ายหรือ Webhook และลองใหม่อีกครั้ง',\r\n        timestamp: new Date().toISOString(),\r\n      }\r\n      updateMessages([...updatedMessages, errorMessage])\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  const sendMessage = async () => {\r\n    if (!input.trim()) return\r\n\r\n    setIsLoading(true)\r\n    const userMessage: ChatMessage = {\r\n      id: Date.now().toString(),\r\n      type: 'user',\r\n      text: input,\r\n      timestamp: new Date().toISOString(),\r\n    }\r\n\r\n    const updatedMessages = [...messages, userMessage]\r\n    updateMessages(updatedMessages)\r\n    setInput('')\r\n\r\n    const webhookUrl = getWebhookUrl()\r\n    if (!webhookUrl) {\r\n      const errorMessage: ChatMessage = {\r\n        id: (Date.now() + 1).toString(),\r\n        type: 'ai',\r\n        text: 'ไม่ได้กำหนดค่า Webhook หรือ URL ไม่ถูกต้อง กรุณาตั้งค่า URL Webhook ที่ถูกต้องในแผงควบคุมผู้ดูแล',\r\n        timestamp: new Date().toISOString(),\r\n      }\r\n      updateMessages([...updatedMessages, errorMessage])\r\n      setIsLoading(false)\r\n      return\r\n    }\r\n\r\n    try {\r\n      const controller = new AbortController()\r\n      // Mirror server timeout (5 minutes)\r\n      const timeout = setTimeout(() => controller.abort(), 300000)\r\n\r\n      const response = await fetch('/api/proxy', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          webhookUrl,\r\n          message: input,\r\n          messages: updatedMessages.slice(-6),\r\n        }),\r\n        signal: controller.signal,\r\n      })\r\n      clearTimeout(timeout)\r\n\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        const aiMessage: ChatMessage = {\r\n          id: (Date.now() + 1).toString(),\r\n          type: 'ai',\r\n          text: data.output || 'ได้รับการตอบกลับแล้ว',\r\n          audio: data.audio ? `data:audio/mp3;base64,${data.audio}` : undefined,\r\n          timestamp: new Date().toISOString(),\r\n        }\r\n        const finalMessages = [...updatedMessages, aiMessage]\r\n        updateMessages(finalMessages)\r\n      } else {\r\n        safeLogError('Proxy returned non-OK status:', response.status)\r\n        const errorMessage: ChatMessage = {\r\n          id: (Date.now() + 1).toString(),\r\n          type: 'ai',\r\n          text: `ข้อผิดพลาดของพร็อกซี่: ${response.status} ${response.statusText}`,\r\n          timestamp: new Date().toISOString(),\r\n        }\r\n        updateMessages([...updatedMessages, errorMessage])\r\n      }\r\n    } catch (err) {\r\n      safeLogError('Error sending message:', err)\r\n      const errorMessage: ChatMessage = {\r\n        id: (Date.now() + 1).toString(),\r\n        type: 'ai',\r\n        text: err && (err as any).name === 'AbortError' ? 'คำขอหมดเวลา กรุณาลองใหม่อีกครั้ง' : 'ไม่สามารถส่งข้อความของคุณได้ กรุณาตรวจสอบเครือข่ายหรือ Webhook และลองใหม่อีกครั้ง',\r\n        timestamp: new Date().toISOString(),\r\n      }\r\n      updateMessages([...updatedMessages, errorMessage])\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  const playAudio = (audioUrl: string) => {\r\n    if (audioRef.current) {\r\n      audioRef.current.src = audioUrl\r\n      audioRef.current.volume = volume / 100\r\n      audioRef.current.play()\r\n    }\r\n  }\r\n\r\n  const speakText = (text: string) => {\r\n    if ('speechSynthesis' in window) {\r\n      const utterance = new SpeechSynthesisUtterance(text)\r\n      utterance.lang = 'th-TH' // Thai language\r\n      utterance.volume = volume / 100\r\n      \r\n      // Try to select a female voice for Thai\r\n      const voices = speechSynthesis.getVoices()\r\n      const thaiVoices = voices.filter(v => v.lang.startsWith('th'))\r\n      if (thaiVoices.length > 0) {\r\n        // Look for female voice\r\n        let femaleVoice = thaiVoices.find(v => \r\n          v.name.toLowerCase().includes('female') || \r\n          v.name.toLowerCase().includes('woman') ||\r\n          v.name.toLowerCase().includes('หญิง')\r\n        )\r\n        // If no explicit female, try the second voice (often female)\r\n        if (!femaleVoice && thaiVoices.length > 1) {\r\n          femaleVoice = thaiVoices[1]\r\n        }\r\n        // If still no, use first available\r\n        if (!femaleVoice) {\r\n          femaleVoice = thaiVoices[0]\r\n        }\r\n        if (femaleVoice) {\r\n          utterance.voice = femaleVoice\r\n        }\r\n      }\r\n      \r\n      speechSynthesis.speak(utterance)\r\n    }\r\n  }\r\n\r\n  const formatTime = (timestamp: string) => {\r\n    const date = new Date(timestamp)\r\n    return date.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex-1 flex flex-col bg-background font-['Sarabun',sans-serif] overflow-x-hidden lg:max-w-4xl lg:mx-auto\">\r\n      {onToggleLeftPanel && (\r\n        <button\r\n          onClick={onToggleLeftPanel}\r\n          className=\"p-2 self-start hover:bg-muted rounded\"\r\n          title=\"เปิด/ปิดเมนู\"\r\n        >\r\n          <Menu size={24} />\r\n        </button>\r\n      )}\r\n      {/* Messages */}\r\n      <div className=\"flex-1 overflow-y-auto overflow-x-hidden px-1 sm:px-2 py-4 space-y-2 hide-scrollbar\">\r\n        {messages.length === 0 ? (\r\n          <div className=\"flex items-center justify-center h-full text-muted-foreground\">\r\n            <div className=\"text-center\">\r\n              <p className=\"text-xl sm:text-2xl mb-2\">เริ่มการปรึกษาด้านประกัน</p>\r\n              <p className=\"text-lg sm:text-xl\">ส่งข้อความหรือใช้ปุ่มเสียง</p>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          messages.map(msg => (\r\n            <div\r\n              key={msg.id}\r\n              className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}\r\n            >\r\n              <div\r\n                className={`${\r\n                  msg.type === 'user'\r\n                    ? 'max-w-[80vw] sm:max-w-xs lg:max-w-lg'\r\n                    : 'max-w-[85vw] sm:max-w-sm lg:max-w-xl'\r\n                } px-4 sm:px-6 py-3 sm:py-4 rounded-lg ${\r\n                  msg.type === 'user'\r\n                    ? 'bg-primary text-primary-foreground'\r\n                    : 'bg-muted text-foreground border border-border'\r\n                }`}\r\n              >\r\n                <p className=\"text-xl sm:text-lg leading-relaxed\">{msg.text}</p>\r\n                <div className=\"flex items-center justify-between mt-2\">\r\n                  <span className=\"text-sm opacity-75\">{formatTime(msg.timestamp)}</span>\r\n                  {msg.type === 'ai' && (\r\n                    <div className=\"flex gap-1\">\r\n                      {msg.audio && (\r\n                        <button\r\n                          onClick={() => playAudio(msg.audio)}\r\n                          className=\"p-1 rounded-full hover:bg-black/10 transition-colors\"\r\n                          title=\"ฟังเสียงจากเซิร์ฟเวอร์\"\r\n                        >\r\n                          <Volume2 size={16} />\r\n                        </button>\r\n                      )}\r\n                      <button\r\n                        onClick={() => speakText(msg.text)}\r\n                        className=\"p-1 rounded-full hover:bg-black/10 transition-colors\"\r\n                        title=\"ฟังเสียงในเครื่อง\"\r\n                      >\r\n                        <Volume2 size={16} />\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {msg.audio && msg.type === 'user' && (\r\n                  <button\r\n                    onClick={() => playAudio(msg.audio!)}\r\n                    className=\"mt-2 flex items-center gap-2 text-sm opacity-80 hover:opacity-100\"\r\n                  >\r\n                    <Volume2 size={14} />\r\n                    เล่น\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n        {isLoading && (\r\n          <div className=\"flex justify-start\">\r\n            <div className=\"bg-muted text-foreground px-4 sm:px-6 py-3 sm:py-4 rounded-lg border border-border\">\r\n              <p className=\"text-lg sm:text-base\">กำลังพิมพ์{typingDots}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Input Area */}\r\n      <div className=\"border-t border-border p-1 sm:p-4 bg-card\">\r\n        <div className=\"w-full sm:max-w-xl sm:mx-auto\">\r\n          <div className=\"flex flex-col sm:flex-row gap-2 sm:gap-4\">\r\n          <button\r\n            onClick={isRecording ? stopRecording : startRecording}\r\n            className={`p-2 sm:p-4 rounded-lg transition-all text-white font-bold text-sm sm:text-lg ${\r\n              isRecording\r\n                ? 'bg-red-600 hover:bg-red-700'\r\n                : 'bg-blue-600 hover:bg-blue-700'\r\n            }`}\r\n            title={isRecording ? 'คลิกเพื่อหยุดบันทึก' : 'คลิกเพื่อเริ่มบันทึก'}\r\n          >\r\n            <Mic size={18} className=\"sm:w-6 sm:h-6\" />\r\n            <span className=\"ml-2 text-sm sm:text-base\">{isRecording ? 'หยุด' : 'พูด'}</span>\r\n          </button>\r\n          <input\r\n            type=\"text\"\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\r\n            placeholder=\"พิมพ์ข้อความของคุณ...\"\r\n            className=\"flex-1 px-2 sm:px-4 py-2 sm:py-3 bg-input border border-input rounded-lg text-lg sm:text-base text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary\"\r\n            disabled={isRecording || isLoading}\r\n          />\r\n          <button\r\n            onClick={sendMessage}\r\n            disabled={isRecording || isLoading || !input.trim()}\r\n            className=\"p-2 sm:p-4 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\r\n          >\r\n            <Send size={18} className=\"sm:w-6 sm:h-6\" />\r\n          </button>\r\n        </div>\r\n        </div>\r\n      </div>\r\n      <audio ref={audioRef} />\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 664, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tinysx/Documents/GitHub/insure-bot-website/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx'\r\nimport { twMerge } from 'tailwind-merge'\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs))\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,uOAAO,EAAC,IAAA,iMAAI,EAAC;AACtB"}},
    {"offset": {"line": 682, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tinysx/Documents/GitHub/insure-bot-website/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react'\r\nimport { Slot } from '@radix-ui/react-slot'\r\nimport { cva, type VariantProps } from 'class-variance-authority'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\r\n        destructive:\r\n          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\r\n        outline:\r\n          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',\r\n        secondary:\r\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\r\n        ghost:\r\n          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',\r\n        link: 'text-primary underline-offset-4 hover:underline',\r\n      },\r\n      size: {\r\n        default: 'h-9 px-4 py-2 has-[>svg]:px-3',\r\n        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\r\n        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\r\n        icon: 'size-9',\r\n        'icon-sm': 'size-8',\r\n        'icon-lg': 'size-10',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: 'default',\r\n      size: 'default',\r\n    },\r\n  },\r\n)\r\n\r\nfunction Button({\r\n  className,\r\n  variant,\r\n  size,\r\n  asChild = false,\r\n  ...props\r\n}: React.ComponentProps<'button'> &\r\n  VariantProps<typeof buttonVariants> & {\r\n    asChild?: boolean\r\n  }) {\r\n  const Comp = asChild ? Slot : 'button'\r\n\r\n  return (\r\n    <Comp\r\n      data-slot=\"button\"\r\n      className={cn(buttonVariants({ variant, size, className }))}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Button, buttonVariants }\r\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,qPAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,+SAAI,GAAG;IAE9B,qBACE,4TAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf;KAnBS"}},
    {"offset": {"line": 747, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tinysx/Documents/GitHub/insure-bot-website/components/left-panel.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Trash2, Plus } from 'lucide-react'\r\nimport { ChatMessage } from '@/types'\r\n\r\ninterface LeftPanelProps {\r\n  chats: Array<{ id: string; title: string; timestamp: string; messages: ChatMessage[] }>\r\n  currentChatId: string | null\r\n  onNewChat: () => void\r\n  onSelectChat: (id: string) => void\r\n  onDeleteChat: (id: string) => void\r\n  volume: number\r\n  onVolumeChange: (volume: number) => void\r\n  isOpen: boolean\r\n  onClose: () => void\r\n}\r\n\r\nexport default function LeftPanel({\r\n  chats,\r\n  currentChatId,\r\n  onNewChat,\r\n  onSelectChat,\r\n  onDeleteChat,\r\n  volume,\r\n  onVolumeChange,\r\n  isOpen,\r\n  onClose,\r\n}: LeftPanelProps) {\r\n  const [showSettings, setShowSettings] = useState(false)\r\n\r\n  const formatThaiDate = (timestamp: string) => {\r\n    const date = new Date(timestamp)\r\n    const thaiYear = date.getFullYear() + 543 // Buddhist Era\r\n    const monthNames = [\r\n      'ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.',\r\n      'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'\r\n    ]\r\n    const day = date.getDate()\r\n    const month = monthNames[date.getMonth()]\r\n    const year = thaiYear.toString().slice(-2) // Last two digits\r\n    const time = date.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })\r\n    return `${day} ${month} ${year} ${time}`\r\n  }\r\n\r\n  return (\r\n    <div className={`w-64 bg-card border-r border-border flex flex-col h-screen shadow-sm absolute left-0 top-0 z-10 transition-transform duration-300 ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>\r\n      {isOpen && (\r\n        <button\r\n          onClick={onClose}\r\n          className=\"absolute top-4 right-4 p-2 rounded-full bg-muted hover:bg-muted/80 z-20\"\r\n          title=\"ปิดเมนู\"\r\n        >\r\n          ✕\r\n        </button>\r\n      )}\r\n      {/* Header */}\r\n      <div className=\"p-4 border-b border-border\">\r\n        <h1 className=\"text-xl font-bold text-card-foreground flex items-center gap-2\">\r\n          <span className=\"w-8 h-8 bg-primary text-primary-foreground rounded-lg flex items-center justify-center text-sm font-bold\">\r\n            SSO\r\n          </span>\r\n          SSO Chatbot\r\n        </h1>\r\n      </div>\r\n\r\n      {/* New Chat Button */}\r\n      <div className=\"p-4\">\r\n        <Button\r\n          onClick={onNewChat}\r\n          className=\"w-full bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-medium flex items-center justify-center gap-2\"\r\n        >\r\n          <Plus size={20} />\r\n          สร้างแชทใหม่\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Chat History */}\r\n      <div className=\"flex-1 overflow-y-auto px-2 space-y-2\">\r\n        {chats.length === 0 ? (\r\n          <div className=\"text-center py-8 text-muted-foreground text-sm\">\r\n            ยังไม่มีแชท สร้างแชทใหม่ได้เลย!\r\n          </div>\r\n        ) : (\r\n          chats.map(chat => (\r\n            <div\r\n              key={chat.id}\r\n              className={`p-3 rounded-lg cursor-pointer transition-all group ${\r\n                currentChatId === chat.id\r\n                  ? 'bg-primary/10 border border-primary/30'\r\n                  : 'hover:bg-muted border border-transparent'\r\n              }`}\r\n              onClick={() => onSelectChat(chat.id)}\r\n            >\r\n              <div className=\"flex justify-between items-start gap-2\">\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"font-medium text-sm truncate text-card-foreground\">\r\n                    {chat.title}\r\n                  </p>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    {formatThaiDate(chat.timestamp)}\r\n                  </p>\r\n                </div>\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation()\r\n                    onDeleteChat(chat.id)\r\n                  }}\r\n                  className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                >\r\n                  <Trash2 size={16} className=\"text-destructive\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n\r\n      {/* Settings Section */}\r\n      <div className=\"p-4 border-t border-border\">\r\n        <button\r\n          onClick={() => setShowSettings(!showSettings)}\r\n          className=\"w-full text-left text-sm font-medium text-card-foreground hover:text-primary transition-colors\"\r\n        >\r\n          การตั้งค่า\r\n        </button>\r\n        {showSettings && (\r\n          <div className=\"mt-3 space-y-3\">\r\n            <div>\r\n              <label className=\"text-xs text-muted-foreground block mb-2\">\r\n                เสียง: {volume}%\r\n              </label>\r\n              <input\r\n                type=\"range\"\r\n                min=\"0\"\r\n                max=\"100\"\r\n                value={volume}\r\n                onChange={(e) => onVolumeChange(parseInt(e.target.value))}\r\n                className=\"w-full\"\r\n              />\r\n            </div>\r\n            <a\r\n              href=\"/admin\"\r\n              className=\"block text-xs text-primary hover:text-primary/80 transition-colors\"\r\n            >\r\n              แผงควบคุมผู้ดูแล →\r\n            </a>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;;;AAJA;;;;AAmBe,SAAS,UAAU,EAChC,KAAK,EACL,aAAa,EACb,SAAS,EACT,YAAY,EACZ,YAAY,EACZ,MAAM,EACN,cAAc,EACd,MAAM,EACN,OAAO,EACQ;;IACf,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,wSAAQ,EAAC;IAEjD,MAAM,iBAAiB,CAAC;QACtB,MAAM,OAAO,IAAI,KAAK;QACtB,MAAM,WAAW,KAAK,WAAW,KAAK,IAAI,eAAe;;QACzD,MAAM,aAAa;YACjB;YAAQ;YAAQ;YAAS;YAAS;YAAQ;YAC1C;YAAQ;YAAQ;YAAQ;YAAQ;YAAQ;SACzC;QACD,MAAM,MAAM,KAAK,OAAO;QACxB,MAAM,QAAQ,UAAU,CAAC,KAAK,QAAQ,GAAG;QACzC,MAAM,OAAO,SAAS,QAAQ,GAAG,KAAK,CAAC,CAAC,GAAG,kBAAkB;;QAC7D,MAAM,OAAO,KAAK,kBAAkB,CAAC,SAAS;YAAE,MAAM;YAAW,QAAQ;QAAU;QACnF,OAAO,GAAG,IAAI,CAAC,EAAE,MAAM,CAAC,EAAE,KAAK,CAAC,EAAE,MAAM;IAC1C;IAEA,qBACE,4TAAC;QAAI,WAAW,CAAC,kIAAkI,EAAE,SAAS,kBAAkB,qBAAqB;;YAClM,wBACC,4TAAC;gBACC,SAAS;gBACT,WAAU;gBACV,OAAM;0BACP;;;;;;0BAKH,4TAAC;gBAAI,WAAU;0BACb,cAAA,4TAAC;oBAAG,WAAU;;sCACZ,4TAAC;4BAAK,WAAU;sCAA2G;;;;;;wBAEpH;;;;;;;;;;;;0BAMX,4TAAC;gBAAI,WAAU;0BACb,cAAA,4TAAC,wIAAM;oBACL,SAAS;oBACT,WAAU;;sCAEV,4TAAC,iSAAI;4BAAC,MAAM;;;;;;wBAAM;;;;;;;;;;;;0BAMtB,4TAAC;gBAAI,WAAU;0BACZ,MAAM,MAAM,KAAK,kBAChB,4TAAC;oBAAI,WAAU;8BAAiD;;;;;2BAIhE,MAAM,GAAG,CAAC,CAAA,qBACR,4TAAC;wBAEC,WAAW,CAAC,mDAAmD,EAC7D,kBAAkB,KAAK,EAAE,GACrB,2CACA,4CACJ;wBACF,SAAS,IAAM,aAAa,KAAK,EAAE;kCAEnC,cAAA,4TAAC;4BAAI,WAAU;;8CACb,4TAAC;oCAAI,WAAU;;sDACb,4TAAC;4CAAE,WAAU;sDACV,KAAK,KAAK;;;;;;sDAEb,4TAAC;4CAAE,WAAU;sDACV,eAAe,KAAK,SAAS;;;;;;;;;;;;8CAGlC,4TAAC;oCACC,SAAS,CAAC;wCACR,EAAE,eAAe;wCACjB,aAAa,KAAK,EAAE;oCACtB;oCACA,WAAU;8CAEV,cAAA,4TAAC,2SAAM;wCAAC,MAAM;wCAAI,WAAU;;;;;;;;;;;;;;;;;uBAxB3B,KAAK,EAAE;;;;;;;;;;0BAiCpB,4TAAC;gBAAI,WAAU;;kCACb,4TAAC;wBACC,SAAS,IAAM,gBAAgB,CAAC;wBAChC,WAAU;kCACX;;;;;;oBAGA,8BACC,4TAAC;wBAAI,WAAU;;0CACb,4TAAC;;kDACC,4TAAC;wCAAM,WAAU;;4CAA2C;4CAClD;4CAAO;;;;;;;kDAEjB,4TAAC;wCACC,MAAK;wCACL,KAAI;wCACJ,KAAI;wCACJ,OAAO;wCACP,UAAU,CAAC,IAAM,eAAe,SAAS,EAAE,MAAM,CAAC,KAAK;wCACvD,WAAU;;;;;;;;;;;;0CAGd,4TAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;;;;;;;;;;;;;;;;;;;AAQb;GAtIwB;KAAA"}},
    {"offset": {"line": 1017, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tinysx/Documents/GitHub/insure-bot-website/app/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport ChatInterface from '@/components/chat-interface'\r\nimport LeftPanel from '@/components/left-panel'\r\nimport { ChatMessage } from '@/types'\r\n\r\nexport default function Home() {\r\n  const [chats, setChats] = useState<Array<{ id: string; title: string; timestamp: string; messages: ChatMessage[] }>>([])\r\n  const [currentChatId, setCurrentChatId] = useState<string | null>(null)\r\n  const [volume, setVolume] = useState(50)\r\n  const [leftPanelOpen, setLeftPanelOpen] = useState(true)\r\n\r\n  // Safe logging utility\r\n  const safeLogError = (message: string, ...args: any[]) => {\r\n    if (typeof console !== 'undefined' && console.warn) {\r\n      (console as any).warn(message, ...args)\r\n    }\r\n  }\r\n\r\n  // Load data from localStorage on mount\r\n  useEffect(() => {\r\n    try {\r\n      const savedChats = localStorage.getItem('insure-bot-chats')\r\n      const savedVolume = localStorage.getItem('insure-bot-volume')\r\n      const savedCurrentChatId = localStorage.getItem('insure-bot-current-chat-id')\r\n      if (savedChats) setChats(JSON.parse(savedChats))\r\n      if (savedVolume) setVolume(parseInt(savedVolume))\r\n      if (savedCurrentChatId) setCurrentChatId(savedCurrentChatId)\r\n    } catch (err) {\r\n      safeLogError('Failed to load saved data from localStorage:', err)\r\n      // If parsing or access fails, clear potentially corrupted keys\r\n      try { localStorage.removeItem('insure-bot-chats') } catch {}\r\n      try { localStorage.removeItem('insure-bot-volume') } catch {}\r\n      try { localStorage.removeItem('insure-bot-current-chat-id') } catch {}\r\n      try { localStorage.removeItem('insure-bot-current-chat-id') } catch {}\r\n    }\r\n  }, [])\r\n\r\n  // Save chats to localStorage whenever they change\r\n  useEffect(() => {\r\n    const isQuotaExceeded = (e: any) => {\r\n      if (!e) return false\r\n      return (\r\n        e.name === 'QuotaExceededError' ||\r\n        e.name === 'NS_ERROR_DOM_QUOTA_REACHED' ||\r\n        // numeric codes for older browsers\r\n        e.code === 22 || e.code === 1014\r\n      )\r\n    }\r\n\r\n    try {\r\n      localStorage.setItem('insure-bot-chats', JSON.stringify(chats))\r\n    } catch (err: any) {\r\n      safeLogError('Failed to save chats to localStorage:', err)\r\n      if (isQuotaExceeded(err)) {\r\n        // Try to shrink the payload and retry: keep most recent chats, and trim messages per chat\r\n        try {\r\n          const maxChats = 10\r\n          const maxMessagesPerChat = 10\r\n          const trimmed = chats\r\n            .slice(0, maxChats)\r\n            .map(c => ({ ...c, messages: c.messages ? c.messages.slice(-maxMessagesPerChat) : [] }))\r\n          localStorage.setItem('insure-bot-chats', JSON.stringify(trimmed))\r\n          // update in-memory to the trimmed version so UI matches stored data\r\n          setChats(trimmed)\r\n        } catch (err2) {\r\n          safeLogError('Failed to save trimmed chats to localStorage:', err2)\r\n          try { localStorage.removeItem('insure-bot-chats') } catch {}\r\n          setChats([])\r\n        }\r\n      }\r\n    }\r\n  }, [chats])\r\n\r\n  // Save volume to localStorage whenever it changes\r\n  useEffect(() => {\r\n    localStorage.setItem('insure-bot-volume', volume.toString())\r\n  }, [volume])\r\n\r\n  // Save currentChatId to localStorage whenever it changes\r\n  useEffect(() => {\r\n    localStorage.setItem('insure-bot-current-chat-id', currentChatId || '')\r\n  }, [currentChatId])\r\n\r\n  const createNewChat = () => {\r\n    const newChatId = Date.now().toString()\r\n    const newChat = {\r\n      id: newChatId,\r\n      title: 'New Chat',\r\n      timestamp: new Date().toLocaleString(),\r\n      messages: [],\r\n    }\r\n    setChats([newChat, ...chats])\r\n    setCurrentChatId(newChatId)\r\n  }\r\n\r\n  const deleteChat = (id: string) => {\r\n    setChats(chats.filter(chat => chat.id !== id))\r\n    if (currentChatId === id) {\r\n      setCurrentChatId(chats.length > 1 ? chats[0].id : null)\r\n    }\r\n  }\r\n\r\n  const selectChat = (id: string) => {\r\n    setCurrentChatId(id)\r\n  }\r\n\r\n  const updateChatMessages = (messages: ChatMessage[]) => {\r\n    // When persisting messages, only keep audio for the current chat and\r\n    // only the most recent user and ai audio blobs to save storage space.\r\n    const sanitizeMessagesForStorage = (msgs: ChatMessage[], isCurrent: boolean) => {\r\n      if (!isCurrent) {\r\n        // For non-current chats remove all audio references\r\n        return msgs.map(m => ({ ...m, audio: undefined }))\r\n      }\r\n\r\n      // For current chat: keep only the latest user audio and the latest ai audio\r\n      let latestUserAudioId: string | null = null\r\n      let latestAiAudioId: string | null = null\r\n\r\n      for (let i = msgs.length - 1; i >= 0; i--) {\r\n        const m = msgs[i]\r\n        if (!latestUserAudioId && m.type === 'user' && m.audio) latestUserAudioId = m.id\r\n        if (!latestAiAudioId && m.type === 'ai' && m.audio) latestAiAudioId = m.id\r\n        if (latestUserAudioId && latestAiAudioId) break\r\n      }\r\n\r\n      return msgs.map(m => {\r\n        if (m.type === 'user') {\r\n          return { ...m, audio: m.id === latestUserAudioId ? m.audio : undefined }\r\n        }\r\n        if (m.type === 'ai') {\r\n          return { ...m, audio: m.id === latestAiAudioId ? m.audio : undefined }\r\n        }\r\n        return { ...m, audio: undefined }\r\n      })\r\n    }\r\n\r\n    setChats(chats.map(chat =>\r\n      chat.id === currentChatId\r\n        ? {\r\n            ...chat,\r\n            messages: sanitizeMessagesForStorage(messages, true),\r\n            title: messages[0]?.text?.substring(0, 30) || 'New Chat',\r\n          }\r\n        : {\r\n            ...chat,\r\n            messages: sanitizeMessagesForStorage(chat.messages || [], false),\r\n          }\r\n    ))\r\n  }\r\n\r\n  const currentChat = chats.find(chat => chat.id === currentChatId)\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-background\">\r\n      <LeftPanel\r\n        chats={chats}\r\n        currentChatId={currentChatId}\r\n        onNewChat={createNewChat}\r\n        onSelectChat={selectChat}\r\n        onDeleteChat={deleteChat}\r\n        volume={volume}\r\n        onVolumeChange={setVolume}\r\n        isOpen={leftPanelOpen}\r\n        onClose={() => setLeftPanelOpen(false)}\r\n      />\r\n      {currentChatId ? (\r\n        <ChatInterface\r\n          chatMessages={currentChat?.messages || []}\r\n          onMessagesUpdate={updateChatMessages}\r\n          volume={volume}\r\n          onToggleLeftPanel={() => setLeftPanelOpen(!leftPanelOpen)}\r\n        />\r\n      ) : (\r\n        <div className=\"flex-1 flex items-center justify-center text-muted-foreground px-4\">\r\n          <div className=\"text-center max-w-md\">\r\n            <h1 className=\"text-xl sm:text-4xl font-bold mb-2 text-foreground\">ยินดีต้อนรับสู่ SSO Chatbot</h1>\r\n            <p className=\"mb-6 text-base sm:text-xl\">เริ่มแชทใหม่เพื่อเริ่มการปรึกษาด้านประกัน</p>\r\n            <button\r\n              onClick={createNewChat}\r\n              className=\"px-4 sm:px-8 py-2 sm:py-3 bg-primary text-primary-foreground rounded-lg hover:opacity-90 transition-opacity text-sm sm:text-lg font-medium\"\r\n            >\r\n              เริ่มแชทใหม่\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}